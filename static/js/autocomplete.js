var RedisLabsAutocomplete=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):null},o=function(e,t){return e.closest?e.closest(t):function(e,t){for(var n=e;n&&1===n.nodeType;){if(s(n,t))return n;n=n.parentNode}return null}(e,t)},i=function(e){return Boolean(e&&"function"==typeof e.then)},r=function t(){var s=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.search,l=r.autoSelect,u=void 0!==l&&l,c=r.setValue,d=void 0===c?function(){}:c,h=r.setAttribute,p=void 0===h?function(){}:h,f=r.onUpdate,b=void 0===f?function(){}:f,v=r.onSubmit,y=void 0===v?function(){}:v,g=r.onShow,w=void 0===g?function(){}:g,x=r.onHide,m=void 0===x?function(){}:x,L=r.onLoading,S=void 0===L?function(){}:L,C=r.onLoaded,R=void 0===C?function(){}:C;e(this,t),n(this,"value",""),n(this,"searchCounter",0),n(this,"results",[]),n(this,"selectedIndex",-1),n(this,"handleInput",(function(e){var t=e.target.value;s.updateResults(t),s.value=t})),n(this,"handleKeyDown",(function(e){var t=e.key;switch(t){case"Up":case"Down":case"ArrowUp":case"ArrowDown":var n="ArrowUp"===t||"Up"===t?s.selectedIndex-1:s.selectedIndex+1;e.preventDefault(),s.handleArrows(n);break;case"Tab":s.selectResult();break;case"Enter":var o=s.results[s.selectedIndex];s.selectResult(),s.onSubmit(o);break;case"Esc":case"Escape":s.hideResults(),s.setValue();break;default:return}})),n(this,"handleFocus",(function(e){var t=e.target.value;s.updateResults(t),s.value=t})),n(this,"handleBlur",(function(){s.hideResults()})),n(this,"handleResultMouseDown",(function(e){e.preventDefault()})),n(this,"handleResultClick",(function(e){console.log("here");var t=e.target,n=o(t,"[data-result-index]");if(n){s.selectedIndex=parseInt(n.dataset.resultIndex,10);var i=s.results[s.selectedIndex];s.selectResult(),s.onSubmit(i)}})),n(this,"handleArrows",(function(e){var t=s.results.length;s.selectedIndex=(e%t+t)%t,s.onUpdate(s.results,s.selectedIndex)})),n(this,"selectResult",(function(){var e=s.results[s.selectedIndex];e&&s.setValue(e),s.hideResults()})),n(this,"updateResults",(function(e){var t=++s.searchCounter;s.onLoading(),s.search(e).then((function(e){t===s.searchCounter&&(s.results=e,s.onLoaded(),0!==s.results.length?(s.selectedIndex=s.autoSelect?0:-1,s.onUpdate(s.results,s.selectedIndex),s.showResults()):s.hideResults())}))})),n(this,"showResults",(function(){s.setAttribute("aria-expanded",!0),s.onShow()})),n(this,"hideResults",(function(){s.selectedIndex=-1,s.results=[],s.setAttribute("aria-expanded",!1),s.setAttribute("aria-activedescendant",""),s.onUpdate(s.results,s.selectedIndex),s.onHide()})),n(this,"checkSelectedResultVisible",(function(e){var t=e.querySelector('[data-result-index="'.concat(s.selectedIndex,'"]'));if(t){var n=e.getBoundingClientRect(),o=t.getBoundingClientRect();o.top<n.top?e.scrollTop-=n.top-o.top:o.bottom>n.bottom&&(e.scrollTop+=o.bottom-n.bottom)}})),this.search=i(a)?a:function(e){return Promise.resolve(a(e))},this.autoSelect=u,this.setValue=d,this.setAttribute=p,this.onUpdate=b,this.onSubmit=y,this.onShow=w,this.onHide=m,this.onLoading=S,this.onLoaded=R},a=0,l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(++a)},u=function(e,t){var n=e.getBoundingClientRect(),s=t.getBoundingClientRect();return n.bottom+s.height>window.innerHeight&&window.innerHeight-n.bottom<n.top&&window.pageYOffset+n.top-s.height>0?"above":"below"},c=function(e,t,n){var s;return function(){var o=this,i=arguments,r=function(){s=null,n||e.apply(o,i)},a=n&&!s;clearTimeout(s),s=setTimeout(r,t),a&&e.apply(o,i)}},d=function(){function n(t,s,o){e(this,n),this.id="".concat(o,"-result-").concat(t),this.class="".concat(o,"-result"),this["data-result-index"]=t,this.tabindex=t,this.role="option",t===s&&(this["aria-selected"]="true")}var s,o,i;return s=n,(o=[{key:"toString",value:function(){var e=this;return Object.keys(this).reduce((function(t,n){return"".concat(t," ").concat(n,'="').concat(e[n],'"')}),"")}}])&&t(s.prototype,o),i&&t(s,i),n}();return function t(s){var o=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.search,h=i.onSubmit,p=void 0===h?function(){}:h,f=i.onUpdate,b=void 0===f?function(){}:f,v=i.baseClass,y=void 0===v?"autocomplete":v,g=i.autoSelect,w=i.getResultValue,x=void 0===w?function(e){return e}:w,m=i.renderResult,L=i.debounceTime,S=void 0===L?0:L;e(this,t),n(this,"expanded",!1),n(this,"loading",!1),n(this,"position",{}),n(this,"resetPosition",!0),n(this,"initialize",(function(){o.root.style.position="relative",o.input.setAttribute("role","combobox"),o.input.setAttribute("autocomplete","off"),o.input.setAttribute("autocapitalize","off"),o.input.setAttribute("autocorrect","off"),o.input.setAttribute("spellcheck","false"),o.input.setAttribute("aria-autocomplete","list"),o.input.setAttribute("aria-haspopup","listbox"),o.input.setAttribute("aria-expanded","false"),o.resultList.setAttribute("role","listbox"),o.resultContainer.style.position="absolute",o.resultContainer.style.zIndex="1",o.resultContainer.style.width="100%",o.resultContainer.style.boxSizing="border-box",o.resultList.id||(o.resultList.id=l("".concat(o.baseClass,"-result-list-"))),o.input.setAttribute("aria-owns",o.resultList.id),document.body.addEventListener("click",o.handleDocumentClick),o.input.addEventListener("keydown",o.handleKeyDown),o.input.addEventListener("input",o.core.handleInput),o.input.addEventListener("focus",o.core.handleFocus),o.resultList.addEventListener("mousedown",o.core.handleResultMouseDown),o.resultList.addEventListener("click",o.core.handleResultClick),o.updateStyle()})),n(this,"updateStyle",(function(){o.root.dataset.expanded=o.expanded,o.root.dataset.loading=o.loading,o.root.dataset.position=o.position,o.resultContainer.style.visibility=o.expanded?"visible":"hidden",o.resultContainer.style.pointerEvents=o.expanded?"auto":"none","below"===o.position?(o.resultContainer.style.bottom=null,o.resultContainer.style.top="100%"):(o.resultContainer.style.top=null,o.resultContainer.style.bottom="100%")})),n(this,"handleKeyDown",(function(e){var t=e.key;switch(t){case"Up":case"Down":case"ArrowUp":case"ArrowDown":var n="ArrowUp"===t||"Up"===t?o.core.selectedIndex-1:o.core.selectedIndex+1;e.preventDefault(),o.core.handleArrows(n);break;case"Tab":o.core.selectResult();break;case"Enter":var s=o.core.results[o.core.selectedIndex];if(!s)return;o.core.selectResult(),o.core.onSubmit(s);break;case"Esc":case"Escape":o.core.hideResults(),o.core.setValue();break;default:return}})),n(this,"setAttribute",(function(e,t){o.input.setAttribute(e,t)})),n(this,"setValue",(function(e){o.input.value=e?o.getResultValue(e):""})),n(this,"renderResult",(function(e,t,n){return"<li ".concat(t,">").concat(o.getResultValue(e,n),"</li>")})),n(this,"organizeResultsBySection",(function(e){var t={},n=[];return e.forEach((function(e){var s=e.hierarchy[0],o=e.hierarchy.length>1?e.hierarchy[1]:e.hierarchy[0],i=t[s];if(void 0===i){var r={name:s,secondLevelOrder:[o]};r[o]=[e],t[s]=r,n.push(s)}else i.hasOwnProperty(o)||(i[o]=[],i.secondLevelOrder.push(o)),i[o].push(e)})),{topLevelNodes:t,topLevelOrder:n}})),n(this,"handleUpdate",(function(e,t){o.resultList.innerHTML="";var n=-1,s=[],i=o.organizeResultsBySection(e);i.topLevelOrder.forEach((function(e){var r=i.topLevelNodes[e];o.resultList.insertAdjacentHTML("beforeend",'\n        <li class="search-root-item">\n          <div class="search-root">\n            '.concat(e,"\n          </div>\n        </li>\n      ")),r.secondLevelOrder.forEach((function(e){r[e].forEach((function(e){var i=new d(n+=1,t,o.baseClass),r=o.renderResult(e,i,n);"string"==typeof r?o.resultList.insertAdjacentHTML("beforeend",r):o.resultList.insertAdjacentElement("beforeend",r),s.push(e)}))}))})),o.core.results=s,e=s,o.input.setAttribute("aria-activedescendant",t>-1?"".concat(o.baseClass,"-result-").concat(t):""),o.resetPosition&&(o.resetPosition=!1,o.position=u(o.input,o.resultList),o.updateStyle()),o.core.checkSelectedResultVisible(o.resultList),o.onUpdate(e,t)})),n(this,"handleShow",(function(){o.expanded=!0,o.updateStyle()})),n(this,"handleHide",(function(){o.expanded=!1,o.resetPosition=!0,o.updateStyle()})),n(this,"handleLoading",(function(){o.loading=!0,o.updateStyle()})),n(this,"handleLoaded",(function(){o.loading=!1,o.updateStyle()})),n(this,"handleDocumentClick",(function(e){console.log("here",e,e.target),e.target&&o.root.contains(e.target)||o.core.hideResults()})),n(this,"updateStyle",(function(){o.root.dataset.expanded=o.expanded,o.root.dataset.loading=o.loading,o.root.dataset.position=o.position,o.resultContainer.style.visibility=o.expanded?"visible":"hidden",o.resultContainer.style.pointerEvents=o.expanded?"auto":"none","below"===o.position?(o.resultContainer.style.bottom=null,o.resultContainer.style.top="100%"):(o.resultContainer.style.top=null,o.resultContainer.style.bottom="100%")})),this.root="string"==typeof s?document.querySelector(s):s,this.input=this.root.querySelector("input"),this.resultList=this.root.querySelector("ul"),this.baseClass=y,this.getResultValue=x,this.onUpdate=b,"function"==typeof m&&(this.renderResult=m);var C=new r({search:a,autoSelect:g,setValue:this.setValue,setAttribute:this.setAttribute,onUpdate:this.handleUpdate,onSubmit:p,onShow:this.handleShow,onHide:this.handleHide,onLoading:this.handleLoading,onLoaded:this.handleLoaded});S>0&&(C.handleInput=c(C.handleInput,S)),this.core=C,this.resultContainer=this.root.querySelector(".autocomplete-result-list-wrapper"),this.resultContainer.style.position="absolute",this.resultContainer.style["z-index"]="1",this.resultContainer.style.width="100%",this.resultContainer.style["box-sizing"]="border-box",this.resultContainer.style.visibility="hidden",this.resultContainer.style["pointer-events"]="none",this.resultContainer.style.bottom="100%",this.redisearchLogo=this.root.querySelector(".redisearch-logo"),this.initialize()}}();
